class SpectrumPlayer{constructor(e,t){this.version="1.0.7",this.player=e,this._createPlayerHTML(t),this.audio=e.querySelector("audio#spectrum-audio"),this.source=e.querySelector("source#spectrum-source"),this.ui_timelineBar=e.querySelector("#spectrum-timeline"),this.ui_timelineHead=e.querySelector("#spectrum-timeline .spectrum-value"),this.ui_body=e.querySelector("#spectrum-body"),this.ui_timelineBuffer=e.querySelector("#spectrum-timeline .spectrum-buffer"),this.ui_volumeBar=e.querySelector('#spectrum-volume[data-control="volume"]'),this.ui_volumeKnob=e.querySelector('#spectrum-volume[data-control="volume"] .spectrum-value'),this.ui_time=e.querySelector("#spectrum-time"),this.ui_duration=e.querySelector("#spectrum-duration"),this.ui_spinner=e.querySelector("#spectrum-buffering"),this.ui_art=e.querySelector("#spectrum-art"),this.ui_playPauseBtn=e.querySelector('#spectrum-playpause[data-control="playpause"]'),this.ui_prevBtn=e.querySelector('#spectrum-prev[data-control="prev"]'),this.ui_nextBtn=e.querySelector('#spectrum-next[data-control="next"]'),this.ui_muteUnmuteBtn=e.querySelector('#spectrum-muteunmute[data-control="muteunmute"]'),this.ui_currentSong,this.currentIndex=0,this.isPlaying=!1,this.isMuted=!1,this.playList=[],this.volume,this.shouldLoopSet,this.shouldPlayNext,this.connectedPlayer,this._eventMap={},this._isScrubbing=!1,this._isBuffering=!1,this.ERROR_TITLE="Spectrum Player Error: ",this._adoptSettings(),this._initPlaylist(),this._createSongTitles(),this._registerAllListeners(),this.playSong(0,!0)}play(){if(this.isPlaying=!0,this.connectedPlayer){var e=this;spectrumPlayers.forEach(function(t,i){t.connectedPlayer&&t.isPlaying&&t!=e&&t.pause()})}try{this.audio.play(),this.ui_playPauseBtn.querySelector(".spectrum-icon").classList.add("fa-pause"),this.ui_playPauseBtn.querySelector(".spectrum-icon").classList.remove("fa-play"),this.ui_body.scrollTop=this.playList[this.currentIndex].element.offsetTop,document.title="â™«  "+this._getSongTitle(this.currentIndex),this._dispatchEvent("onplay",this.playList[this.currentIndex])}catch(e){this.audio.pause()}}playSong(e,t=!1){if(this.audio.pause(),e<0||e>=this.playList.length)console.error(this.ERROR_TITLE,"Index "+e+" out of bounds!");else{this.currentIndex=e,this.source.src=this.playList[e].src,this.audio.currentTime=0,this.audio.volume=this.volume,this.audio.muted=this.isMuted,this.ui_timelineBuffer.style.width="0%",this.ui_timelineHead.style.width="0%",void 0!==this.playList[e].img?this.ui_art.style.backgroundImage="url('"+this.playList[e].img+"')":this.ui_art.style.backgroundImage="none",this._highlightSong(e);try{this.audio.load(),this._dispatchEvent("onsongchange",this.playList[this.currentIndex]),t||this.play()}catch(e){}}}playNext(){this.playSong((this.currentIndex+1)%this.playList.length)}playPrev(){this.playSong((this.currentIndex-1+this.playList.length)%this.playList.length)}pause(){this.isPlaying=!1,this.audio.pause(),this.ui_playPauseBtn.querySelector(".spectrum-icon").classList.add("fa-play"),this.ui_playPauseBtn.querySelector(".spectrum-icon").classList.remove("fa-pause"),document.title=originalPageTitle,this._dispatchEvent("onpause",this.playList[this.currentIndex])}mute(){this.audio.muted=!0,this.isMuted=!0,this.ui_muteUnmuteBtn.querySelector(".spectrum-icon").classList.add("fa-volume-mute"),this.ui_muteUnmuteBtn.querySelector(".spectrum-icon").classList.remove("fa-volume-up")}unmute(){this.audio.muted=!1,this.isMuted=!1,this.ui_muteUnmuteBtn.querySelector(".spectrum-icon").classList.add("fa-volume-up"),this.ui_muteUnmuteBtn.querySelector(".spectrum-icon").classList.remove("fa-volume-mute")}setVolume(e){e=this._clamp(e,0,1),this.unmute(),this.audio.volume=e,this.volume=e,this.ui_volumeKnob.style.width=100*e+"%"}addEventListener(e,t){e in this._eventMap||(this._eventMap[e]=new Array),this._eventMap[e].push(t)}removeEventListener(e,t){if(e in this._eventMap){var i=this._eventMap[e];if(void 0===i)return;var s=i.indexOf(t);-1!==s&&i.splice(s,1),this._eventMap[e]=i}}_dispatchEvent(e,t){var i=this._eventMap[e];if(void 0!==i)for(var s=0;s<i.length;s++)i[s](t)}_adoptSettings(){this.connectedPlayer=this._getData(this.player,"connected",!0),this.volume=this._getData(this.player,"volume",.75),this.shouldLoopSet=this._getData(this.player,"loopSet",!1),this.shouldPlayNext=this._getData(this.player,"playNext",!0),this.setVolume(this.volume)}_buffer(e){e?this.ui_spinner.classList.add("show"):this.ui_spinner.classList.remove("show")}_registerAllListeners(){var e=this;function t(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}this.ui_playPauseBtn.addEventListener("click",function(t){return t.preventDefault(),e.isPlaying?e.pause():e.play(),!1}),this.ui_timelineBar.addEventListener("mousedown",function(i){if(1==i.which){function s(i){t(i),e._isScrubbing=!0;var s=i.clientX-e.ui_timelineBar.getBoundingClientRect().left,u=e._clamp(s/e.ui_timelineBar.offsetWidth,0,1);return e.audio.currentTime=u*e.audio.duration,e.ui_timelineHead.style.width=100*u+"%",u}document.addEventListener("mousemove",s),document.addEventListener("mouseup",function t(i){!function(t){var i=s(t);e._isScrubbing=!1,i>=.99&&e.audio.dispatchEvent(new Event("ended"))}(i),document.removeEventListener("mouseup",t),document.removeEventListener("mousemove",s)})}}),this.ui_volumeBar.addEventListener("mouseenter",function(t){window.onwheel=function(t){t.preventDefault();var i=e.volume+.02*Math.sign(t.deltaY);e.setVolume(i)}}),this.ui_volumeBar.addEventListener("mouseleave",function(e){window.onwheel=null}),this.ui_volumeBar.addEventListener("mousedown",function(i){if(1==i.which){function s(i){t(i);var s=(i.clientX-e.ui_volumeBar.getBoundingClientRect().left)/e.ui_volumeBar.offsetWidth;e.setVolume(s)}document.addEventListener("mousemove",s),document.addEventListener("mouseup",function e(t){s(t),document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",s)})}}),this.ui_muteUnmuteBtn.addEventListener("click",function(t){return t.preventDefault(),e.isMuted?e.unmute():e.mute(),!1}),this.playList.forEach(function(t,i){t.element.addEventListener("click",function(t){return t.preventDefault(),e.playSong(i),!1})}),this.ui_nextBtn.addEventListener("click",function(t){return t.preventDefault(),e.playNext(),!1}),this.ui_prevBtn.addEventListener("click",function(t){return t.preventDefault(),e.playPrev(),!1}),this.audio.addEventListener("volumechange",function(t){e.audio.muted?e.mute():e.unmute()}),this.audio.addEventListener("play",function(){e.isPlaying||e.play()}),this.audio.addEventListener("pause",function(){e.isPlaying&&e.pause()}),this.audio.addEventListener("timeupdate",function(){e._isBuffering&&(e._isBuffering=!1,e._buffer(!1));var t=e.audio.duration,i=e.audio.currentTime;if(!isNaN(t)){var s=e._calculateCurrentValue(t),u=e._calculateCurrentValue(i);e.ui_time.innerHTML=u,e.ui_duration.innerHTML=s,e.ui_timelineHead.style.width=i/t*100+"%"}}),this.audio.addEventListener("ended",function(){e._isScrubbing||(e.shouldPlayNext?e.currentIndex==e.playList.length-1?e.shouldLoopSet?e.playSong(0):e.pause():e.playSong(e.currentIndex+1):e.pause())}),this.audio.addEventListener("progress",function(){var t=e.audio.duration;if(t>0)for(var i=0;i<e.audio.buffered.length;i++)if(e.audio.buffered.start(e.audio.buffered.length-1-i)<=e.audio.currentTime){e.ui_timelineBuffer.style.width=e.audio.buffered.end(e.audio.buffered.length-1-i)/t*100+"%";break}}),this.audio.addEventListener("waiting",function(){e._isBuffering=!0,e._buffer(!0)})}_highlightSong(e){void 0!==this.ui_currentSong&&this.ui_currentSong.classList.remove("active"),this.ui_currentSong=this.playList[e].element,this.ui_currentSong.classList.add("active")}_createPlayerHTML(e){var t='<div id="spectrum-art"></div><div id="spectrum-header"><audio id="spectrum-audio" preload="none"><source id="spectrum-source"></source></audio><div id="spectrum-controlls"><a class="spectrum-control" id="spectrum-prev" data-control="prev"><i class="spectrum-icon fas fa-step-backward"></i></a><a class="spectrum-control" id="spectrum-playpause" data-control="playpause"><i class="spectrum-icon fas fa-play"></i></a><a class="spectrum-control" id="spectrum-next" data-control="next"><i class="spectrum-icon fas fa-step-forward"></i></a><span class="spectrum-info" id="spectrum-time">00:00</span><span class="spectrum-info" id="spectrum-time-separator"> / </span><span class="spectrum-info" id="spectrum-duration">00:00</span><a class="spectrum-control" id="spectrum-muteunmute" data-control="muteunmute"><i class="spectrum-icon fas fa-volume-up"></i></a><div class="spectrum-control" id="spectrum-volume" data-control="volume"><div class="spectrum-bar-back"></div><div class="spectrum-value"></div></div><span class="spectrum-info" id="spectrum-buffering"><i class="spectrum-icon fas fa-circle-notch fa-spin"></i></span></div><div class="spectrum-control" id="spectrum-timeline" data-control="timeline"><div class="spectrum-bar-back"></div><div class="spectrum-buffer"></div><div class="spectrum-value"></div></div>';void 0!==e&&(t=e),this.player.insertAdjacentHTML("afterbegin",t)}_createSongTitles(){for(var e=0;e<this.playList.length;e++)this.playList[e].element.innerHTML=this._getSongTitle(e)}_initPlaylist(){for(var e=this.player.querySelectorAll("#spectrum-body ol li a"),t=0;t<e.length;t++)void 0!==e[t].dataset.title&&void 0!==e[t].dataset.src?this.playList.push({index:t,element:e[t],title:e[t].dataset.title,artist:e[t].dataset.artist,src:e[t].dataset.src,img:e[t].dataset.img}):(console.error(this.ERROR_TITLE,"Item at index "+t+" has missing data attributes (data-title or data-src)\n",e[t]),e[t].innerHTML="-")}_getSongTitle(e){return void 0!==this.playList[e].artist?this.playList[e].artist+" - "+this.playList[e].title:this.playList[e].title}_getData(e,t,i){var s=e.dataset[t];return void 0===s?i:""===s||JSON.parse(s)}_clamp(e,t,i){return e<=t?t:e>=i?i:e}_calculateCurrentValue(e){parseInt(e/3600);var t=parseInt(e/60)%60,i=(e%60).toFixed();return(t<10?"0"+t:t)+":"+(i<10?"0"+i:i)}}function initSpectrumPlayers(){for(var e=document.querySelectorAll(".spectrum-player"),t=0;t<e.length;t++)void 0===e[t].initialized&&(spectrumPlayers.push(new SpectrumPlayer(e[t])),e[t].initialized=!0)}var originalPageTitle,spectrumPlayers=[];window.addEventListener("load",function(){originalPageTitle=document.title,initSpectrumPlayers()});