class SpectrumPlayer{constructor(element,customTemplate){this.version="1.0.5";this.player=element;this._createPlayerHTML(customTemplate);this.audio=element.querySelector('audio#spectrum-audio');this.source=element.querySelector('source#spectrum-source');this.ui_timelineBar=element.querySelector('#spectrum-timeline');this.ui_timelineHead=element.querySelector('#spectrum-timeline .spectrum-value');this.ui_body=element.querySelector('#spectrum-body');this.ui_timelineBuffer=element.querySelector('#spectrum-timeline .spectrum-buffer');this.ui_volumeBar=element.querySelector('#spectrum-volume[data-control="volume"]');this.ui_volumeKnob=element.querySelector('#spectrum-volume[data-control="volume"] .spectrum-value')
this.ui_time=element.querySelector('#spectrum-time');this.ui_duration=element.querySelector('#spectrum-duration');this.ui_spinner=element.querySelector('#spectrum-buffering');this.ui_art=element.querySelector('#spectrum-art');this.ui_playPauseBtn=element.querySelector('#spectrum-playpause[data-control="playpause"]');this.ui_prevBtn=element.querySelector('#spectrum-prev[data-control="prev"]');this.ui_nextBtn=element.querySelector('#spectrum-next[data-control="next"]');this.ui_muteUnmuteBtn=element.querySelector('#spectrum-muteunmute[data-control="muteunmute"]');this.ui_currentSong;this.currentIndex=0;this.isPlaying=!1;this.isMuted=!1;this.playList=[];this.volume;this.shouldLoopSet;this.shouldPlayNext;this.connectedPlayer;this._eventMap={};this._isScrubbing=!1;this._isBuffering=!1;this._adoptSettings();this._initPlaylist();this._createSongTitles();this._registerAllListeners();this.playSong(0,!0)}
play(){if(this.connectedPlayer){spectrumPlayers.forEach(function(item,index){if(item.connectedPlayer&&item.isPlaying&&item!=this){item.pause()}})}
this.audio.play();this.isPlaying=!0;this.ui_playPauseBtn.querySelector('.spectrum-icon').classList.add('fa-pause');this.ui_playPauseBtn.querySelector('.spectrum-icon').classList.remove('fa-play');this.ui_body.scrollTop=this.playList[this.currentIndex].element.offsetTop;document.title="\u266B"+"  "+this.playList[this.currentIndex].artist+" - "+this.playList[this.currentIndex].title;this._dispatchEvent("onplay",this.playList[this.currentIndex])}
playSong(index,first=!1){if(index<0||index>=this.playList.length){console.log("Index out of bounds!");return}
this.currentIndex=index;this.source.src=this.playList[index].src;this.audio.currentTime=0;this.audio.volume=this.volume;this.audio.muted=this.isMuted;this.ui_timelineBuffer.style.width="0%";this.ui_timelineHead.style.width="0%";this.ui_art.style.backgroundImage="url('"+this.playList[index].img+"')";this.audio.load();this._highlightSong(index);this._dispatchEvent("onsongchange",this.playList[this.currentIndex]);if(!first)this.play()}
playNext(){this.playSong((this.currentIndex+1)%(this.playList.length))}
playPrev(){this.playSong(((this.currentIndex-1)+this.playList.length)%(this.playList.length))}
pause(){this.audio.pause();this.isPlaying=!1;this.ui_playPauseBtn.querySelector('.spectrum-icon').classList.add('fa-play');this.ui_playPauseBtn.querySelector('.spectrum-icon').classList.remove('fa-pause');document.title=originalPageTitle;this._dispatchEvent("onpause",this.playList[this.currentIndex])}
mute(){this.audio.muted=!0;this.isMuted=!0;this.ui_muteUnmuteBtn.querySelector('.spectrum-icon').classList.add('fa-volume-mute');this.ui_muteUnmuteBtn.querySelector('.spectrum-icon').classList.remove('fa-volume-up')}
unmute(){this.audio.muted=!1;this.isMuted=!1;this.ui_muteUnmuteBtn.querySelector('.spectrum-icon').classList.add('fa-volume-up');this.ui_muteUnmuteBtn.querySelector('.spectrum-icon').classList.remove('fa-volume-mute')}
setVolume(percent){percent=this._clamp(percent,0,1);this.unmute();this.audio.volume=percent;this.volume=percent;this.ui_volumeKnob.style.width=percent*100+"%"}
addEventListener(name,func){if(!(name in this._eventMap)){this._eventMap[name]=new Array()}
this._eventMap[name].push(func)}
removeEventListener(name,func){if(name in this._eventMap){var arr=this._eventMap[name];if(arr===undefined)return;var index=arr.indexOf(func);if(index!==-1)arr.splice(index,1);this._eventMap[name]=arr}}
_dispatchEvent(name,data){var arr=this._eventMap[name];if(arr===undefined)return;for(var i=0;i<arr.length;i++){arr[i](data)}}
_adoptSettings(){this.connectedPlayer=this._getData(this.player,"connected",!0);this.volume=this._getData(this.player,"volume",0.75);this.shouldLoopSet=this._getData(this.player,"loopSet",!1);this.shouldPlayNext=this._getData(this.player,"playNext",!0);this.setVolume(this.volume)}
_buffer(shouldBuffer){if(shouldBuffer)
this.ui_spinner.classList.add("show");else this.ui_spinner.classList.remove("show")}
_registerAllListeners(){var self=this;this.ui_playPauseBtn.addEventListener('click',function(e){e.preventDefault();if(self.isPlaying){self.pause()}else{self.play()}
return!1});this.ui_timelineBar.addEventListener('mousedown',function(e){if(e.which==1){document.addEventListener('mousemove',scrubb);document.addEventListener('mouseup',function onUp(e){playheadChange(e);document.removeEventListener('mouseup',onUp);document.removeEventListener('mousemove',scrubb)});function scrubb(e){pauseEvent(e);self._isScrubbing=!0;var elLeft=e.clientX-self.ui_timelineBar.getBoundingClientRect().left;var percent=self._clamp(elLeft/self.ui_timelineBar.offsetWidth,0,1);self.audio.currentTime=percent*self.audio.duration;self.ui_timelineHead.style.width=percent*100+"%";return percent}
function playheadChange(e){var percent=scrubb(e);self._isScrubbing=!1;if(percent>=0.99){self.audio.dispatchEvent(new Event('ended'))}}}});this.ui_volumeBar.addEventListener('mouseenter',function(e){window.onwheel=function(e){e.preventDefault();var percent=(self.volume+(0.02*Math.sign(e.deltaY)));self.setVolume(percent)}});this.ui_volumeBar.addEventListener('mouseleave',function(e){window.onwheel=null});this.ui_volumeBar.addEventListener('mousedown',function(e){if(e.which==1){document.addEventListener('mousemove',volumeChange);document.addEventListener('mouseup',function onUp(e){volumeChange(e);document.removeEventListener('mouseup',onUp);document.removeEventListener('mousemove',volumeChange)});function volumeChange(e){pauseEvent(e);var elLeft=e.clientX-self.ui_volumeBar.getBoundingClientRect().left;var percent=elLeft/self.ui_volumeBar.offsetWidth;self.setVolume(percent)}}});this.ui_muteUnmuteBtn.addEventListener('click',function(e){e.preventDefault();if(self.isMuted){self.unmute()}else{self.mute()}
return!1});this.playList.forEach(function(song,index){song.element.addEventListener('click',function(e){e.preventDefault();self.playSong(index);return!1})});this.ui_nextBtn.addEventListener('click',function(e){e.preventDefault();self.playNext();return!1});this.ui_prevBtn.addEventListener('click',function(e){e.preventDefault();self.playPrev();return!1});this.audio.addEventListener('volumechange',function(e){if(self.audio.muted)
self.mute()
else self.unmute()});this.audio.addEventListener('play',function(){if(!self.isPlaying)self.play()});this.audio.addEventListener('pause',function(){if(self.isPlaying)self.pause()});this.audio.addEventListener('timeupdate',function(){if(self._isBuffering){self._isBuffering=!1;self._buffer(!1)}
var length=self.audio.duration;var currentTime=self.audio.currentTime;if(isNaN(length))return;var length_ui=self._calculateCurrentValue(length);var currentTime_ui=self._calculateCurrentValue(currentTime);self.ui_time.innerHTML=currentTime_ui;self.ui_duration.innerHTML=length_ui;self.ui_timelineHead.style.width=(currentTime/length)*100+"%"});this.audio.addEventListener('ended',function(){if(self._isScrubbing)return;if(!self.shouldPlayNext){self.pause();return}
if(self.currentIndex==self.playList.length-1){if(self.shouldLoopSet){self.playSong(0)}else{self.pause()}}else{self.playSong(self.currentIndex+1)}});this.audio.addEventListener('progress',function bufferUpdate(){var duration=self.audio.duration;if(duration>0){for(var i=0;i<self.audio.buffered.length;i++){if(self.audio.buffered.start(self.audio.buffered.length-1-i)<=self.audio.currentTime){self.ui_timelineBuffer.style.width=(self.audio.buffered.end(self.audio.buffered.length-1-i)/duration)*100+"%";break}}}});this.audio.addEventListener('waiting',function bufferUpdate(){self._isBuffering=!0;self._buffer(!0)});function pauseEvent(e){if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();e.cancelBubble=!0;e.returnValue=!1;return!1}}
_highlightSong(index){if(this.ui_currentSong!==undefined)
this.ui_currentSong.classList.remove('active');this.ui_currentSong=this.playList[index].element;this.ui_currentSong.classList.add('active')}
_createPlayerHTML(custom){var htmltree='<div id="spectrum-art"></div>'+'<div id="spectrum-header">'+'<audio id="spectrum-audio" preload="none">'+'<source id="spectrum-source"></source>'+'</audio>'+'<div id="spectrum-controlls">'+'<a class="spectrum-control" id="spectrum-prev" data-control="prev">'+'<i class="spectrum-icon fas fa-step-backward"></i>'+'</a>'+'<a class="spectrum-control" id="spectrum-playpause" data-control="playpause">'+'<i class="spectrum-icon fas fa-play"></i>'+'</a>'+'<a class="spectrum-control" id="spectrum-next" data-control="next">'+'<i class="spectrum-icon fas fa-step-forward"></i>'+'</a>'+'<span class="spectrum-info" id="spectrum-time">00:00</span>'+'<span class="spectrum-info" id="spectrum-time-separator"> / </span>'+'<span class="spectrum-info" id="spectrum-duration">00:00</span>'+'<a class="spectrum-control" id="spectrum-muteunmute" data-control="muteunmute">'+'<i class="spectrum-icon fas fa-volume-up"></i>'+'</a>'+'<div class="spectrum-control" id="spectrum-volume" data-control="volume">'+'<div class="spectrum-bar-back"></div>'+'<div class="spectrum-value"></div>'+'</div>'+'<span class="spectrum-info" id="spectrum-buffering">'+'<i class="spectrum-icon fas fa-circle-notch fa-spin"></i>'+'</span>'+'</div>'+'<div class="spectrum-control" id="spectrum-timeline" data-control="timeline">'+'<div class="spectrum-bar-back"></div>'+'<div class="spectrum-buffer"></div>'+'<div class="spectrum-value"></div>'+'</div>'
'</div>';if(custom!==undefined)
htmltree=custom;this.player.insertAdjacentHTML('afterbegin',htmltree)}
_createSongTitles(){for(var i=0;i<this.playList.length;i++){this.playList[i].element.innerHTML=this.playList[i].artist+" - "+this.playList[i].title}}
_initPlaylist(){var arr=this.player.querySelectorAll('#spectrum-body ol li a');for(var i=0;i<arr.length;i++){this.playList.push({index:i,element:arr[i],title:arr[i].dataset.title,artist:arr[i].dataset.artist,src:arr[i].dataset.src,img:arr[i].dataset.img,})}}
_getData(element,name,def){var tmp=element.dataset[name];if(tmp===undefined)return def;if(tmp==="")return!0;return JSON.parse(tmp)}
_clamp(num,min,max){return num<=min?min:num>=max?max:num}
_calculateCurrentValue(currentTime){var current_hour=parseInt(currentTime/3600)%24;var current_minute=parseInt(currentTime/60)%60;var current_seconds_long=currentTime%60;var current_seconds=current_seconds_long.toFixed();var current_time=(current_minute<10?"0"+current_minute:current_minute)+":"+(current_seconds<10?"0"+current_seconds:current_seconds);return current_time}}
function initSpectrumPlayers(){var players=document.querySelectorAll('.spectrum-player');for(var i=0;i<players.length;i++){if(players[i].initialized===undefined){spectrumPlayers.push(new SpectrumPlayer(players[i]));players[i].initialized=!0}}}
var spectrumPlayers=[];var originalPageTitle;window.addEventListener('load',function(){originalPageTitle=document.title;initSpectrumPlayers()})